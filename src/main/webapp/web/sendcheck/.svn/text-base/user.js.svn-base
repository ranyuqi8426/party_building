Ext.onReady(function() {
	var addOrUpdate = 0;// 定义新增还是修改的标示

	Ext.define('PointUser', {
		extend : 'Ext.data.Model',
		fields : [ {
			name : 'user_id',
			type : 'string'
		}, {
			name : 'point',
			type : 'string'
		}, {
			name : 'point_gets',
			type : 'string'
		}, {
			name : 'point_exchange',
			type : 'string'
		},{
			name : 'user_name',
			type : 'string'
		},{
			name : 'mobile',
			type : 'string'
		} ]
	});

	var userStore = Ext.create('Ext.data.Store', {
		model : 'PointUser',
		pageSize : pagelimit,
		proxy : {
			type : 'ajax',
			url : basePath + '/point/user/search.do',
			actionMethods : {
				read : "POST"
			},
			reader : {
				rootProperty : 'root'
			}
		},
		autoLoad : false,
		listeners : {
			beforeload : function(store) {
				Ext.apply(store.proxy.extraParams, {
					user_mobile : Ext.getCmp('txtUser_mobile').getValue()
				});
			}
		}
	});

	var selUserModel = Ext.create('Ext.selection.CheckboxModel', {
		mode : 'SINGLE'
	});

	var userTb = Ext.create('Ext.toolbar.Toolbar', {
		layout : {
			overflowHandler : 'Menu'
		},
		items : ['用户名/手机号', {
			xtype : 'textfield',
			width : 130,
			id : 'txtUser_mobile'
		}, {
			xtype : 'button',
			glyph : glyphSearch,
			text : '查询',
			handler : function() {
				searchUser();
			}
		}, {
			xtype : 'button',
			glyph : glyphClear,
			text : '清空',
			handler : function() {
				clearUser();
			}
		} ]
	});

	var userGrid = Ext.create('Ext.grid.Panel', {
		title : '会员积分表列表',
		frame : true,
		glyph : glyphGrid,
		width : '100%',
		height : pageH,
		collapsible : true,// 表头缩回按钮
		store : userStore,
		selModel : selUserModel,
		renderTo : Ext.getBody(),
		columns : [ {
			xtype : 'rownumberer',
			width : 40
		}, {
			text : '用户名',
			dataIndex : 'user_name',
			width : 120,
			align : 'center',
			sortable : false
		}, {
			text : '手机号',
			dataIndex : 'mobile',
			width : 100,
			align : 'center',
			sortable : false
		}, {
			text : '当前积分数',
			dataIndex : 'point',
			width : 100,
			align : 'center',
			sortable : false
		}, {
			text : '总获取积分',
			dataIndex : 'point_gets',
			width : 100,
			align : 'center',
			sortable : false
		}, {
			text : '已兑换积分',
			dataIndex : 'point_exchange',
			width : 100,
			align : 'center',
			sortable : false
		}],
		viewConfig : {
			stripeRows : true,
			enableTextSelection : true
		},
		tbar : userTb,
		bbar : Ext.create('Ext.PagingToolbar', {
			store : userStore,
			displayInfo : true
		})
	});

	
	var userViewWin = new Ext.Window({
		width : 300,
		height : 230,
		glyph : glyphWindow,
		title : '『查看会员积分表』',
		modal : true,
		closeAction : 'hide',
		padding : 4,
		items : [  ]
	});

	// searchUser();
	// 查询
	function searchUser() {
		var txtUser_mobile = Ext.getCmp('txtUser_mobile').getValue();
		if(txtUser_mobile==''){
			Ext.Msg.alert('操作提示', '请输入用户名/手机号');
		}else{
			userStore.loadPage(1);
		}
		
	}
	// 选择性条件清空
	function clearUser() {
		Ext.getCmp('txtUser_mobile').setValue('');
		
	}

	// 查看
	function viewUser(record) {
		userViewForm.getForm().loadRecord(record);
		setFormReadOnly(userViewForm, true);
		userViewWin.show();
	}

	// 自适应大小
	Ext.GlobalEvents.on('resize', function() {
		userGrid.getView().refresh();
		userGrid.setWidth('100%')
	})
});